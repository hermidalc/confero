<tool name="Create Ranked Lists" id="confero_platform_create_ranked_lists" force_history_refresh="True" version="0.0.1">
    <description>from a contrast dataset or single contrast in your history or in the Confero DB</description>
    <command interpreter="perl">
        ../bin/cfo_run_cmd.pl create_ranked_lists
        --rank-column="$rank_column"
        --output-id-type="$id_type"
        #if $data_source_cond.data_source == "confero_db"
        --data-id="$data_source_cond.data_type_cond.data_id"
        --output-file=$ranked_list_1
            #if $data_source_cond.data_type_cond.data_type == "contrast_dataset"
        --output-file-galaxy-id=$ranked_list_1.id
        --output-dir=$__new_file_path__
            #end if
        #else if $data_source_cond.data_source == "galaxy_history"
        --input-file=$data_source_cond.dataset_file
        --orig-filename="$data_source_cond.dataset_file.name"
        --output-file=$ranked_list_2
        --output-file-galaxy-id=$ranked_list_2.id
        --output-dir=$__new_file_path__
        #end if
    </command>
    <inputs>
        <conditional name="data_source_cond">
            <param name="data_source" type="select" optional="false" label="Select Data From">
                <option value="confero_db">Confero DB</option>
                <option value="galaxy_history">Galaxy History</option>
            </param>
            <when value="confero_db">
                <conditional name="data_type_cond">
                    <param name="data_type" type="select" optional="false" label="Data type">
                        <option value="contrast_dataset">Contrast Dataset</option>
                        <option value="contrast">Contrast</option>
                    </param>
                    <when value="contrast_dataset">
                        <param name="data_id" type="select" label="Contrast Dataset ID" dynamic_options="cfo_get_info('contrast_dataset_ids')"/>
                    </when>
                    <when value="contrast">
                        <param name="data_id" type="select" label="Contrast ID" dynamic_options="cfo_get_info('contrast_ids')"/>
                    </when>
                </conditional>
            </when>
            <when value="galaxy_history">
                <param name="dataset_file" type="data" format="ctkcontrastdataset" label="Select Contrast Dataset"/>
            </when>
        </conditional>
        <param name="rank_column" type="select" force_select="true" optional="false" label="Output Rank Column">
            <option value="S">Statistic metric (S)</option>
            <option value="M">Log2 Fold Change (M)</option>
        </param>
        <param name="id_type" type="select" force_select="true" optional="false" label="Output ID Type">
            <option value="EntrezGene" selected="true">Entrez Gene</option>
            <option value="GeneSymbol">Gene Symbol</option>
        </param>
    </inputs>
    <outputs>
        <data name="ranked_list_1" format="ctkrnk" label="Ranked List for $data_source_cond.data_type_cond.data_id.value">
            <filter>data_source_cond['data_source'] == "confero_db"</filter>
        </data>
        <data name="ranked_list_2" format="ctkrnk" label="Ranked List for $data_source_cond.dataset_file.name">
            <filter>data_source_cond['data_source'] == "galaxy_history"</filter>
        </data>
    </outputs>
    <code file="common_functions.py"/>
    <help>
This tool will generate ranked lists from a contrast dataset or single contrast in your Galaxy history or from the Confero DB.
    </help>
</tool>
